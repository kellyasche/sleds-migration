---
title: "Analysis - local employment"
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 4
runtime: shiny
resource_files:
- Data/Shapefiles/County shapefiles/MNCounties_MNDOT.cpg
- Data/Shapefiles/County shapefiles/MNCounties_MNDOT.dbf
- Data/Shapefiles/County shapefiles/MNCounties_MNDOT.prj
- Data/Shapefiles/County shapefiles/MNCounties_MNDOT.sbn
- Data/Shapefiles/County shapefiles/MNCounties_MNDOT.sbx
- Data/Shapefiles/County shapefiles/MNCounties_MNDOT.shp.xml
- Data/Shapefiles/County shapefiles/MNCounties_MNDOT.shx
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(tidyverse)
library(sf)
library(ggrepel)
library(scales)
library(shiny)
library(shinycssloaders)
library(ggiraph)
library(kableExtra)
library(rmapshaper)
library(cowplot)
library(DT)
library(htmlwidgets)
library(RColorBrewer)
library(readxl)
library(janitor)
library(lubridate)
library(systemfonts)
reset_font_cache()
library(ggtext)
library(gmodels)
library(leaps)
library(bestglm)
library(fastDummies)
library(car)

```

```{r join docs, include=FALSE}
theme_bar <- theme_bw() +
  theme(panel.grid.major = element_line(color = "grey70", size = 0.1),
        panel.grid.minor = element_blank(),
        axis.ticks = element_blank(),
        axis.text = element_text(face = "bold"),
        panel.border = element_blank(),
        legend.background = element_rect(fill = "transparent", color = "transparent"),
        legend.key = element_rect(fill = "transparent"),
        legend.key.size = unit(1, "lines"),
        legend.margin = margin(0,0,0,0),
        legend.title = element_blank(),
        legend.text = element_text(margin = margin(l = 2)),
        text = element_text(family = "Arial") ,
        plot.title.position = "plot",
        plot.title = element_text(face = "bold"))

theme_line <- theme_bw() +
  theme(legend.background = element_rect(fill = "transparent", color = "transparent"),
        legend.key = element_rect(fill = "transparent"),
        legend.text = element_text(margin = margin(l = 2)),
        panel.grid.minor = element_blank(),
        panel.grid.major = element_line(color = "grey70", size = 0.1),
        axis.ticks = element_blank(),
        axis.text = element_text(face = "bold"),
        panel.border = element_blank(),
        legend.margin = margin(0,0,0,0),
        legend.key.size = unit(1, "lines"),
        text = element_text(family = "Arial") ,
        plot.title.position = "plot",
        plot.title = element_text(face = "bold"))


theme_sf <- theme_bw() +
  theme(axis.text.x=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks=element_blank(),
        panel.background = element_blank(),
        panel.grid.major = element_line(color = "white"),
        panel.border = element_blank(),
        legend.title = element_blank(),
        legend.text = element_text(margin = margin(l = 2)),
        legend.margin = margin(0,0,0,0),
        legend.key.size = unit(1, "lines"),
        text = element_text(family = "Arial") ,
        plot.title.position = "plot",
        plot.title = element_text(face = "bold"))

regions <- read_csv("Data/Join docs/county_regions.csv") %>%
    select(5,6) %>%
    unique() %>%
    mutate(edr = str_replace(edr, "  ", " "),
           planning.region = str_replace(planning.region, " Minnesota", ""),
           planning.region = fct_relevel(planning.region, "Northwest", "Northeast", "Central", "Seven County Mpls-St Paul", "Southwest", "Southeast"),
           edr = fct_relevel(edr, "EDR 1 - Northwest", "EDR 2 - Headwaters", "EDR 3 - Arrowhead", "EDR 4 - West Central", "EDR 5 - North Central", "EDR 6E- Southwest Central", "EDR 6W- Upper Minnesota Valley", "EDR 7E- East Central", "EDR 7W- Central", "EDR 8 - Southwest", "EDR 9 - South Central", "EDR 10 - Southeast", "EDR 11 - 7 County Twin Cities", "Minnesota"))

counties.regions <- read_csv("Data/Join docs/county_regions.csv") %>%
  rename(mif = `MIF Region`) %>%
  mutate(countyfp = formatC(countyfp, width = 3, flag = "0"),
         Name = str_to_title(Name),
         Name = str_replace(Name, "Q", "q"),
         Name = str_replace(Name, "Of The", "of the"),
         Name = str_replace(Name, "Mcleod", "McLeod"),
         Dem_Desc = ifelse(Name == "Minnesota", "Minnesota", Dem_Desc) ,
         edr = str_replace(edr, "  ", " "),
         planning.region = str_replace(planning.region, " Minnesota", ""),
         planning.region = fct_relevel(planning.region, "Northwest", "Northeast", "Central", "Seven County Mpls-St Paul", "Southwest", "Southeast"),
         edr = fct_relevel(edr, "EDR 1 - Northwest", "EDR 2 - Headwaters", "EDR 3 - Arrowhead", "EDR 4 - West Central", "EDR 5 - North Central", "EDR 6E- Southwest Central", "EDR 6W- Upper Minnesota Valley", "EDR 7E- East Central", "EDR 7W- Central", "EDR 8 - Southwest", "EDR 9 - South Central", "EDR 10 - Southeast", "EDR 11 - 7 County Twin Cities", "Minnesota"),
         mif = ifelse(is.na(mif), "TC", mif),
         mif = as.factor(mif),
         mif = fct_relevel(mif, "NW", "NE", "WC", "EC", "SW", "SE", "TC"))


color.ruca <- c("Entirely rural" = "#009933", "Town/rural mix" = "#99CC33", "Urban/town/rural mix" = "#CC9966", "Entirely urban" = "#754C29", "Minnesota" = "black")

color.pr <- c("Northwest" = 	"#4575b4", "Northeast" = "grey", "Central" = "#fee090", "Seven County Mpls-St Paul" = "#d73027", "Southwest" = "#91bfdb", "Southeast" = "#fc8d59", "Minnesota" = "black")

color.edr <- c("EDR 1 - Northwest" = "#b3cde3", "EDR 2 - Headwaters" = "#8c96c6", "EDR 3 - Arrowhead" = "#fe9929", "EDR 4 - West Central" = "#8856a7", "EDR 5 - North Central" = "#810f7c", "EDR 6E- Southwest Central" = "#e5f5f9", "EDR 6W- Upper Minnesota Valley" = "#bdc9e1", "EDR 7E- East Central" = "#99d8c9", "EDR 7W- Central" = "#2ca25f", "EDR 8 - Southwest" = "#74a9cf", "EDR 9 - South Central" = "#0570b0", "EDR 10 - Southeast" = "#d7301f", "EDR 11 - 7 County Twin Cities" = "#d8b365", "Minnesota" = "black")

color.pr.edr <- c ("Northwest" = "#4575b4","Northeast" = "#e0f3f8", "Central" = "#fee090", "Seven County Mpls-St Paul" = "#d73027", "Southwest" = "#91bfdb", "Southeast" = "#fc8d59", "Minnesota" = "black", "EDR 1 - Northwest" = "#b3cde3", "EDR 2 - Headwaters" = "#8c96c6", "EDR 3 - Arrowhead" = "#fe9929", "EDR 4 - West Central" = "#8856a7", "EDR 5 - North Central" = "#810f7c", "EDR 6E- Southwest Central" = "#e5f5f9", "EDR 6W- Upper Minnesota Valley" = "#bdc9e1", "EDR 7E- East Central" = "#99d8c9", "EDR 7W- Central" = "#2ca25f", "EDR 8 - Southwest" = "#74a9cf", "EDR 9 - South Central" = "#0570b0", "EDR 10 - Southeast" = "#d7301f", "EDR 11 - 7 County Twin Cities" = "#d8b365")

mn_counties <- st_read("Data/Shapefiles/county shapefiles/MNCounties_MNDOT.shp", quiet = TRUE) %>%
  ms_simplify(keep = .01, keep_shapes = TRUE) %>%
  rename(countyfp = FIPS_CODE)

```

```{r master original}
master.original <- read.csv("Data/SLEDS/Masters/Master-13.csv") %>%
  mutate(n.institutions = ifelse(is.na(n.institutions), 0, n.institutions),
         ps.attended.in.same.ruca = ifelse(is.na(ps.attended.in.same.ruca), "Never attended ps", ps.attended.in.same.ruca),
         ps.attended.in.same.edr = ifelse(is.na(ps.attended.in.same.edr), "Never attended ps", ps.attended.in.same.edr),
         ps.attended.in.same.pr = ifelse(is.na(ps.attended.in.same.pr), "Never attended ps", ps.attended.in.same.pr),
         ps.attended.in.MN = ifelse(is.na(ps.attended.in.MN), "Never attended ps", ps.attended.in.MN),
         ps.grad = ifelse(ps.grad == "Y", 1, 0),
         ps.grad.InstitutionSector = ifelse(attended.ps == "No", "Never attended ps", ps.grad.InstitutionSector),
         ps.grad.InstitutionSector = ifelse(attended.ps == "Yes" & ps.grad == 0, "Did not grad", ps.grad.InstitutionSector),
         ps.grad.in.same.ruca = ifelse(attended.ps == "No", "Never attended ps", ps.grad.in.same.ruca),
         ps.grad.in.same.ruca = ifelse(attended.ps == "Yes" & ps.grad == 0, "Did not grad", ps.grad.in.same.ruca),
         ps.grad.in.same.edr = ifelse(attended.ps == "No", "Never attended ps", ps.grad.in.same.edr),
         ps.grad.in.same.edr = ifelse(attended.ps == "Yes" & ps.grad == 0, "Did not grad", ps.grad.in.same.edr),
         ps.grad.in.same.pr = ifelse(attended.ps == "No", "Never attended ps", ps.grad.in.same.pr),
         ps.grad.in.same.pr = ifelse(attended.ps == "Yes" & ps.grad == 0, "Did not grad", ps.grad.in.same.pr),
         ps.grad.in.MN = ifelse(attended.ps == "No", "Never attended ps", ps.grad.in.MN),
         ps.grad.in.MN = ifelse(attended.ps == "Yes" & ps.grad == 0, "Did not grad", ps.grad.in.MN),
         took.ACT = ifelse(is.na(ACTCompositeScore), "No", "Yes"),
         hs.grad.year = ifelse(hs.grad.year == 2008, 1,
                               ifelse(hs.grad.year == 2009, 2,
                                      ifelse(hs.grad.year == 2010, 3,
                                             ifelse(hs.grad.year == 2011, 4,
                                                    ifelse(hs.grad.year == 2012, 5,
                                                           ifelse(hs.grad.year == 2013, 6,
                                                                  ifelse(hs.grad.year == 2014, 7,
                                                                         ifelse(hs.grad.year == 2015, 8,
                                                                                ifelse(hs.grad.year == 2016, 9,
                                                                                       ifelse(hs.grad.year == 2017, 10,
                                                                                              ifelse(hs.grad.year == 2018, 11, 12))))))))))))

write_csv(master.original, "Data/SLEDS/Masters/Master.csv")
```

<br>

The master dataset is composed of `r comma(nrow(master.original))` rows. Each row represents an individual that graduated (StatusEnd = 8 or 9) from a high school located in EDR 6W, EDR 6E, and EDR 8 between 2008 and 2019.

The master dataset is also composed of `r comma(ncol(master.original))` columns. Columns mainly represent various socio-economic, demographic, and educational career characteristics of the indivdual as well as a few characteristics of the high school geographic from which they graduated (i.e. county unemployment).

Here is a list of all the variables that will be included in the model and a description of each.

* **Individual Characteristics**
    + **hs.grad.year:** year the individual graduated high school 
    + **Gender:** 
      + M = male
      + F = female
    + **LimitedEnglishProficiencyIndicator:** 
      + Y = identified as having limited english proficiency at some point between 10th and 12th grade, otherwise N.
    + **HomelessIndicator:** 
      + Y = the individual was  identified as homeless at any point between 10th and 12th grade, otherwise N.
    + **economic.status:** 
      + 1 = the individual was eligible for free or reduced lunch (codes 1,2,4,5) at any point between 10th and 12th grade, otherwise 0.
    + **pseo.participant:** 
      + 1 = the individual participated in a PSEO course sometime between 10th and 12th grade, otherwise 0.
    + **SpecialEdStatus:** 
      + 1 = the individual required special education services at some point between 10th and 12th grade, otherwise 0.
    + **non.english.home:**   
      + 1 = the individual was identifed as having English as not the primary langauge spoken at home between 10th and 12th grad, otherwise 0.
    + **n.years.attended:** the number of years the individual attended the high school and is identified in the dataset. Max is 6 years.
    + **ACTCompositeScore:** the composite ACT score of the individual. If the ACT was not taken, the individual is NA.
    + **ap.exam:**
      + 1 = the individual took an AP exam at some point, 
      + 0 = the individual did not take an AP exam.
    + **total.cte.courses.taken:** the total number of CTE courses the individual has taken in their career since 10th grade.
    + **cte.0 through cte.26:** the number of CTE courses taken in each CTE career cluster, where;
      + 0 = NULL - no career field or career name
      + 1 = Agriculture, Food, and Natural Resources	
      + 2 = Architecture & Construction	
      + 3 = Manufacturing	
      + 4 = Transportation, Distribution & Logistics	
      + 5 = Information Technology	
      + 6 = Marketing, Sales & Service	
      + 7 = Finance
      + 8 = Hospitality & Tourism	
      + 9 = Business, Management & Administrative	
      + 10 = Health Science & Health Occupations	
      + 11 = Human Services	
      + 12 = Arts, A/V Technology, & Communication	
      + 14 = Science, Technology, Engineering, & Mathematics	
      + 21 = Work-Experience-Disadvantaged	
      + 22 = Work Experience-Handicapped	
      + 23 = Work Experience-Handicapped (16-20+ on IEP)
      + 24 = Work Experience/Career Exploration (age 14-15 on IEP)
      + 25 = Diversified Occupations
      + 26 = Administrative Only
    + **cte.achievement:** three indicators with 
      + "CTE concentrator or completor" being one, 
      + "CTE participant" meaning they took a CTE course but was not a concentrator or completor, and, 
      + "No CTE" meaning they didn't take a CTE course.
    + **english.learner:** 
      + 1 = the individual was identified as an "english learner" at least one time between 10th and 12th grade, otherwise 0.
    + **MCA.M & MCA.R & MCA.S:** this is the Minnesota Comprehensive Assessment tests for reading, math and science. Each individual is given 1 of 4 grades for each subject;
      + 1 = Does not meet standards
      + 2 = Partially meets standards
      + 3 = Meets standards
      + 4 = Exceeds standards
    + **sat.taken:** 
      + 1 = individual took the SAT at some point between 10th and 12th grade, otherwise 0.
    + **attended.ps:** 
      + Yes = the individual lattended a post-secondary education institution, otherwise No.
    + **first.InstitutionSector:** this identifies the institution sector of their first post-secondary school. There are 10 different sectors.
      + 1 - Public, 4-year or above
      + 2 - Private not-for-profit, 4-year or above
      + 3 - Private for-profit, 4-year or above
      + 4 - Public, 2-year
      + 5 - Private not-for-profit, 2-year
      + 6 - Private for-profit, 2-year
      + 7 - Public, less-than 2-year
      + 8 - Private not-for-profit, less-than 2-year
      + 9 - Private for-profit, less-than 2-year
      + 10 - multiple sectors (if attended multiple institutions)
      + 99 - Sector unknown (not active)
      + NA - did not attend post-secondary
    + **ps.sector.(1-10):** each number represents "1 through 10" institution sector types.
      + 1 = the individual attended the particular post-secondary institution sector, otherwise 0.
    + **ps.attended.in.same.ruca/edr:** two columns which identify whether the PersonID ever attended a post-secondary institution in the same RUCA category or economic development region as their high school.
      + "Outside ruca/edr" = individual never attended a post-secondary institution within the RUCA category or economic development region as their high school.
      + "In same ruca/edr" = individual attended a post-secondary institution(s) only within the same RUCA category or economic development region as their high school. 
      + "Inside and outside same ruca/edr" = individual attended post-secondary institutions within and outside the same RUCA category or EDR as their high school.
      + "Never attended ps" = individual never attended a post-secondary institution.
    + **ps.attended.in.same.pr:** one column which identifies whether the individual attended a post-secondary institution within the three economic development regions being rearched (EDR 6W, EDF 6E, and EDR 8).
      + "In same PR" = individual attended a post-secondary institution(s) in one of the three EDRs only. 
      + "Outside PR" = individual never attended a post-secondary institution(s) in one the three EDRs.
      + "Inside and outside same PR" = individual attended post-secondary institutions within and outside one of the three EDRs.
      "Never attended ps" = individual never attended a post-secondary institution.
    + **ps.attended.in.MN:** one column which identifies whether the individual attended a post-secondary institution within Minnesota.
      + "In MN" = individual attended a post-secondary institution(s) in Minnesota only.
      + "Outside MN" = individual never attended a post-secondary institution(s) in Minnesota.
      + "Inside and outside MN" = individual attended a post-secondary institution(s) inside and outside Minnesota.
      + "Never attended ps" = never attended post-secondary institution
    + **ps.grad:**
      + 1 = the individual gradated from a post-secondary institution otherwise 0.
    + **ps.grad.InstitutionSector:** the institution sector of the post-secondary school from which an individual has graduated.
      + 1-10 = the codes of the institution sector provided above.
      + "Never attended ps" = the individual never attended a post-secondary institution
      + "Did not graduate" = the individual attended a post-secondary institution but did not graduate.
    + **highest.cred.level:** an identifier of the highest credential earned by the PersonID. The categories are;
      + Less than associate degree
      + Associate degree
      + Bachelors degree
      + Higher than bachelors degree.
    + **ps.grad.in.same.ruca/edr:** did the student graduate from an institution located in the same RUCA category or EDR as their high school. 
      + "Outside ruca/edr" = individual never graduated from a post-secondary institution within the RUCA category or economic development region as their high school.
      + "In same ruca/edr" = individual graduated from a post-secondary institution(s) only within the same RUCA category or economic development region as their high school. 
      + "Inside and outside same ruca/edr" = individual graduates from a post-secondary institutions within and outside the same RUCA category or EDR as their high school.
      + "Never attended ps" = individual never attended a post-secondary institution."PR" is whether they graduated from an institution within the research area (three EDRs) and "MN" is whether they graduated from an institution in Minnesota.
      + "Did not grad" = individual attended a post-secondary institution but never graduated.
    + **ps.grad.in.same.pr:** one column indentifying whether the individual graduated from a post-secondary institution in one of the three economic development regions being research.
      + "In same PR" = individual graduated from a post-secondary institution(s) in one of the three EDRs only. 
      + "Outside PR" = individual never graduated from a post-secondary institution(s) in one the three EDRs.
      + "Inside and outside same PR" = individual graduated from a post-secondary institutions within and outside one of the three EDRs.
      + "Never attended ps" = individual never attended a post-secondary institution.
      + "Did not grad" = individual attended a post secondary institution but did not graduate.
    + **ps.grad.in.MN:** one column indentifying whether the individual graduated from a post-secondary institution located in Minnesota.
      + "In MN" = individual graduated from a post-secondary institution(s) in Minnesota. 
      + "Outside MN" = individual never graduated from a post-secondary institution(s) in Minnesota.
      + "Inside and outside MN" = individual graduated from a post-secondary institutions within and outside Minnesota.
      + "Never attended ps" = individual never attended a post-secondary institution.
      + "Did not grad" = individual attended a post secondary institution but did not graduate.
    + **mn.emp.record.hs.grad.year(.2 & .7):** did the individual have a MN employment record the year of graduating high school, two years after graduating, and seven years after graduating.
      + "MN emp record" = the individual had a MN employment record at that time frame.
      + "No MN emp record" = the individual did not have a MN employment record at that time frame.
    + **meaningful.emp.hs.grad.year(.2 & .7):** did the individual work 1,000 hours or more for one employer the year of graduation, two years after graduation, and seven years after graduation.
      + "Meaningful emp" = individual had meaningful employment in Minnesota at the time frame.
      + "No meaninful emp" = individual did not have meaningful employment in Minnesota at the time frame.
      + "No MN emp record" = the individual did not have a MN employment record at that time frame.
      + "After 2019" = the timeframe for the individual (2 and/or 7 years after graduating) would be after 2019 for which there is no data.
    + **hs.grad.year.(2 & 7).county.match:** did the individual have meaningful employment for an employer located in the same county as their high school - the year of graduation, two years after graduation, and seven years after graduation.
      + "Location match" = the individual had meaningful employment in Minnesota and was in the same county as their high school at that time frame.
      + "No location match" = the individual had meaningful employment in Minnesota but NOT in the same county as their high school at that time frame.
      + "No meaningful emp" = the individual did not have meaningful employment at that time frame.
      + "No MN emp record" = the individual did not have a MN employment record at that time frame.
      + "After 2019" = the time frame for the individual (2 and/or 7 years after graduating) would be after 2019 for which there is no data.
    + **hs.grad.year.(2 & 7).edr.match:** did the individual have meaningful employment for an employer located in the same EDR as their high school - the year of graduation, two years after graduation, and seven years after graduation.
      + "Location match" = the individual had meaningful employment in Minnesota and was in the same EDR as their high school at that time frame.
      + "No location match" = the individual had meaningful employment in Minnesota but NOT in the same EDR as their high school at that time frame.
      + "No meaningful emp" = the individual did not have meaningful employment at that time frame.
      + "No MN emp record" = the individual did not have a MN employment record at that time frame.
      + "After 2019" = the time frame for the individual (2 and/or 7 years after graduating) would be after 2019 for which there is no data.
    + **hs.grad.year.(2 & 7).region.match:** did the individual have meaningful employment in one of the three EDRs - the year of graduation, two years after graduation, and seven years after graduation.
      + "Location match" = the individual had meaningful employment in Minnesota and was in one of the three research economic development regions at that time frame.
      + "No location match" = the individual had meaningful employment in Minnesota but NOT in one of the three EDRs at that time frame.
      + "No meaningful emp" = the individual did not have meaningful employment at that time frame.
      + "No MN emp record" = the individual did not have a MN employment record at that time frame.
      + "After 2019" = the time frame for the individual (2 and/or 7 years after graduating) would be after 2019 for which there is no data.
    + **hs.grad.year.state.match:** did the individual have meaningful employment for an employer located in Minnesota the year of graduation, two years after graduation and seven years after graduation.
      + "Location match" = the individual had meaningful employment in Minnesota.
      + "No meaningful emp" = the individual did not have meaningful employment at that time frame.
      + "No MN emp record" = the individual did not have a MN employment record at that time frame.
      + "After 2019" = the time frame for the individual (2 and/or 7 years after graduating) would be after 2019 for which there is no data.
    + **ind.match.hs.grad.year(.2 and .7):** did the individual have meaningful employment in an industry that matches a CTE course they took - the year of graduation, two years after graduation and seven years after graduation.
      + "Ind match" = the individual had meaningful employment in Minnesota was working in an industry that corresponds to a career cluster of one of their CTE courses.
      + "No ind match" = the individual took a CTE course, had meaningful employment in Minnesota, but was not in an industry corresponding to one of their CTE career clusters.
      + "No meaningful emp" = the individual had a MN employment record but was not meaningful at that time frame.
      + "No MN emp record" = the individual did not have a MN employment record at that time frame.
      + "After 2019" = the timeframe would have been after 2019 for which there is no data.
    
* **High School Characteristics**
    + **K12OrganizationID:** Identification code for each high school in research region.
    + **countyfp:** the fips code of the code in which the high school is located.
    + **Dem_Desc:** the RUCA category in which the high school is located.
    + **edr:** the economic development region in which the high school is located.
    + **avg.cte.intensity:** The purpose of the CTE intensity measure is to determine whether a strong presence of CTE programming and participation impacts migration patterns. The thinking is that there will be plenty of students that may not dive deep into CTE coursework, but just seeing it in your school and constantly being reminded of all the local opportunities and occupational needs in the local area might impact how a student views employment opportunities for themselves in the future.We needed to come up with a measure of what the CTE “intensity” was for each school by each year. To do this, Eric Shwankl, Education Consultant with the Southwest West Central Service Cooperative, came up with an ingenious way to measure “CTE intensity” using the z-score (also called standard score). The z-score calculates how far a value is (in terms of standard deviation) from the average in the population. In this case z-score is used to measure how far one schools CTE student participation % is from the mean of the percentage of all schools that year, and how far one schools CTE courses offered per student % is from the percentage of all schools for that year. This particular column takes the average z-score from all the school instances for each individual.
    + **avg.unemp.rate:** the three year average unemployment rate during an individuals Sophmore, Junior and Senior years.
    + **wages.3year.avg:** the average county median household income of an individuals SOphomore, Junior and Senior years.
    
    
<br>

# Method steps

There are a number of dependent variables for which we want to measure independent variables. These are;

* hs.grad.year.county.match (2 & 7)
* hs.grad.year.edr.match (2 & 7)
* hs.grad.year.region.match (2 & 7)
* hs.grad.year.state.match (2 & 7)
* ind.match.hs.grad.year (2 & 7)

A few secondary ones include;

* meaningful.emp.hs.grad.year (2 & 7)

Let's now test out our dataset so we know that it will work. With the high number of independent variables, using best subsert selection mthods will not work. There isn't enough computing power. So we will play around with stepwise methods.

We will test out just a few variables first before adding all of them. Let's us hs.grad.year.2.county.match_Location match as the dependent variable.

* Dependent variable = hs.grad.year.2.county.match
    + Location match: The individual had meaningful employment in the same county as their high school two years after graduation.
    + No location match: The individual had meaningful employment in Minnesota but NOT in the same county as their high school.
    + No meaningful emp: The individual had a MN employment record but employment was not meaningful.
    + Unknown: the individual had a MN employment record but was a "Statewide" position so it is unknow location.
    + No MN emp record: The individual did not have a MN employment record.

    
```{r hs.grad.year.2.county.match recode}
hs.grad.year.2.county.match.recode <- master.original %>%
  select(PersonID, hs.grad.year.2.county.match) %>%
  filter(hs.grad.year.2.county.match != "After 2019") %>%
  dummy_cols(select_columns = "hs.grad.year.2.county.match") %>%
  select(PersonID, 'hs.grad.year.2.county.match_Location match') %>%
  mutate(`hs.grad.year.2.county.match_Location match` = as.factor(`hs.grad.year.2.county.match_Location match`))

names(hs.grad.year.2.county.match.recode)
```

<br>

We did filter out all of the "After 2019" individuals so we are left with `r comma(nrow(hs.grad.year.2.county.match.recode))` individuals. 

The independent variables we will use to test our methods will be;

* LimitedEnglishProficienyIndicator
    + Y = Yes
    + N = No
* HomelessIndicator
    + Y = Yes
    + N = No
* economic.status
    + 1 = Free or reduced lunch
    + 0 = No free or reduced lunch
* pseo.participant
    + 1 = Yes
    + 0 = No
* SpecialEdStatus
    + 1 = Yes
    + 0 = No
* non.english.home
    + 1 = Yes
    + 0 = No
* Dem_Desc
    + Entirely rural
    + Town/rural mix
    + Urban/town/rural mix
* edr
    + EDR 6E
    + EDR 6W
    + EDR 8
* ACTCompositeScore
    + Values

<br>

```{r independent variables test}
test.ind.variables <- master.original %>%
  select(PersonID, LimitedEnglishProficiencyIndicator, HomelessIndicator, economic.status, pseo.participant, SpecialEdStatus, non.english.home, Dem_Desc, edr, ACTCompositeScore) %>%
  mutate_at(c(2:9), as.factor) %>%
  mutate(took.ACT = ifelse(is.na(ACTCompositeScore), "N", "Y"),
         took.ACT = as.factor(took.ACT))


names(test.ind.variables)
```

<br>

The dataset with independent variables to test has `r comma(nrow(test.ind.variables))` individuals. Now we will join the independent and dependent variable datasets.

<br>

```{r join dependent and independent variables}
master.test <- hs.grad.year.2.county.match.recode %>%
  left_join(test.ind.variables, by = "PersonID") %>%
  select(-PersonID) %>%
  rename("hs.grad.year.2.county.match.location.match" = 1) 

names(master.test)
```

<br>

Okay, let's test the entire model and see what comes up as being significant.

<br>

```{r test entire model}
test.model <- glm(hs.grad.year.2.county.match.location.match ~ LimitedEnglishProficiencyIndicator + HomelessIndicator + economic.status + pseo.participant + SpecialEdStatus + non.english.home + Dem_Desc + edr + took.ACT,  data = master.test, family = binomial)

summary(test.model)
```

<br>

When running the entire model, we see the following coming up as statistically significant;

* LimitedEnglishProficency1 = Less likely 
* economic.status1 = more likely to have meaningful employment in the county two years after graduation if the the student was eligible for free and/or reduced lunch
* SpecialEdStatus = more likely to have meaningful employment in the county two years after graduation if the student was indetified as needing special education.
* pseo.participant1 = the student was less likely to have meaningful employment in the county two years after graduation if they participated in PSEO.
* Dem_DescTown/rural mix = more likely to have meaningful employment in the county if they graduated from a high school located in a town/rural mix county.
* Dem_DescUrban/town/rural mix = more likely to have meaningful employment in the county if they graduated from a high school located in a urban/town/rural mix county.
* edrEDR 6W- Upper Minnesota Valley = less likely to have meaninhful employment in the county if they graduated from a high school located in EDR 6W.
* edrEDR 8 - Southwest = Less likely to have meaningful employment in the county if they graduated from a high school located in EDR 8.
* took.ACT = Likliness decreases if individual took the ACT.

Let's check to see if there are is any serious multicollinearity in the datset.

<br>

```{r vif test}
collinearity <- vif(test.model)

collinearity
```

<br>

Many of the independent variables are close to 1, indicating minor collinearity. The largest one is non.english.home variable with 1.36, but that isn't really high enough to warrant it being removed from the model. 

Okay, let's see what the steps do for us. We will start with backward stepwise.


<br>

```{r test backward}
step(test.model, direction = "backward")
```

<br>

Through the process, it only removes one varaible, HomeLessIndicator. The final model is;

hs.grad.year.2.county.match_location.match = -1.3386 - (.3785 * LimitedEnglishProficiencyY) + (.1819 * economic.status1) - (.4467 * pseo.participant1) - (.1316 * SpecialEdStatus1) + (.1125 * non.english.home1) + (.4863 * Dem_DescTown/rural mix) + (.2778 * Dem_DescUrban/town/rural mix) - (.5580 * EDR 6W) - (.2789 * EDR 8) - (.5647 * took.ACTY) 

Let's compare this model to stepping forward.

<br>

```{r test forward}
step(test.model, direction = "forward")

```


<br>

Moving forward doesn't end up eliminated any variables. Unlike stepping backwards, this model includes the HomelessIndicator variable. Here is what the model would look like;

hs.grad.year.2.county.match_location.match = -1.3382 - (.3779 * LimitedEnglishProficiencyY) + - (.2585 * HomelessIndicatorY) + (.1843 * economic.status1) - (.4466 * pseo.participant1) - (.1312 * SpecialEdStatus1) + (.1114 * non.english.home1) + (.4868 * Dem_DescTown/rural mix) + (.2779 * Dem_DescUrban/town/rural mix) - (.5588 * EDR 6W) - (.2796 * EDR 8) - (.5653 * took.ACTY) 

Despite the inclusion of the HomelessIndicator variable, the coefficients are very similar to the backward step model.

# Rethinking independent variables

Okay, including all of the variables that I want might be a bit too taxing. So let's get a bit more particular about what to include.

* Demographics
    + hs.grad.year
    + Gender
    + LimitedEnglishProficiencyIndicator
    + HomelessIndicator
    + economic.status
    + pseo.participant
    + SpecialEdStatus
    + Dem_Desc
    + edr
* Education characteristics
    + ACTCompositeScore
    + ap.examp
    + total.cte.courses.taken
    + cte.1 - 26
    + cte.achievement
    + avg.cte.intensity
    + english.learner
    + MCA.M - MCA.S
    + attended.ps
    + highest.cred.level
    + ps.grad.InstitutionSector
    + took.ACT
* Geographic characteristics
    + avg.unemp.rate
    + wages.3year.avg

We will also try using LASSO regression which shrinks the estimators towards 0. 

```{r test lasso}


```

