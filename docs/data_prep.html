<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Data prep</title>

<script src="site_libs/header-attrs-2.14/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#section-TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#section-TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="section-TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">CTE impacts on migration trends in SW Minnesota</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Summary and data overview</a>
</li>
<li>
  <a href="data_prep.html">Data prep process</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="section-header">



<h1 class="title toc-ignore">Data prep</h1>

</div>


<p><br></p>
<div id="section-k12enrollment" class="section level1">
<h1>K12Enrollment</h1>
<p>This dataset is of all the individuals that have graduated from a high school in Southwest Minnesota.</p>
<p><br></p>
<pre class="r"><code>enrollment &lt;- read_csv(&quot;Data/SLEDS/K12 Enrollment/K12Enrollment.csv&quot;)  %&gt;%
  mutate(PersonID = as.integer(PersonID),
         K12OrganizationID = as.integer(K12OrganizationID)) %&gt;%
  drop_na(PersonID)

head(enrollment)</code></pre>
<pre><code>## # A tibble: 6 × 15
##   PersonID K12Organization… K12EnrTimeID Grade EconomicStatusI… FederalRaceIndi…
##      &lt;int&gt;            &lt;int&gt;        &lt;dbl&gt; &lt;dbl&gt;            &lt;dbl&gt; &lt;chr&gt;           
## 1       68           124096     20050630    10                0 NULL            
## 2       68           124083     20060630    11                0 NULL            
## 3       68           124084     20070630    12                0 NULL            
## 4      161            77457     20060630     9                0 NULL            
## 5      161            77450     20070630    10                0 NULL            
## 6      161            77451     20080630    11                0 NULL            
## # … with 9 more variables: PostSecondaryEnrollmentOptionsIndicator &lt;chr&gt;,
## #   PSEOConcurrentEnrollmentIndicator &lt;chr&gt;, RaceEthnicity &lt;dbl&gt;,
## #   StatusEnd &lt;dbl&gt;, Gender &lt;chr&gt;, SpecialEdStatus &lt;dbl&gt;,
## #   LimitedEnglishProficiencyIndicator &lt;chr&gt;, HomePrimaryLanguage &lt;dbl&gt;,
## #   HomelessIndicator &lt;chr&gt;</code></pre>
<pre class="r"><code>names(enrollment)</code></pre>
<pre><code>##  [1] &quot;PersonID&quot;                               
##  [2] &quot;K12OrganizationID&quot;                      
##  [3] &quot;K12EnrTimeID&quot;                           
##  [4] &quot;Grade&quot;                                  
##  [5] &quot;EconomicStatusIndicator&quot;                
##  [6] &quot;FederalRaceIndicator&quot;                   
##  [7] &quot;PostSecondaryEnrollmentOptionsIndicator&quot;
##  [8] &quot;PSEOConcurrentEnrollmentIndicator&quot;      
##  [9] &quot;RaceEthnicity&quot;                          
## [10] &quot;StatusEnd&quot;                              
## [11] &quot;Gender&quot;                                 
## [12] &quot;SpecialEdStatus&quot;                        
## [13] &quot;LimitedEnglishProficiencyIndicator&quot;     
## [14] &quot;HomePrimaryLanguage&quot;                    
## [15] &quot;HomelessIndicator&quot;</code></pre>
<p><br></p>
<p>In the dataset there are 200,350 observations along with 15 columns. Each observation does not represent a unique, unduplicated individual, but rather a unique status for the individual. For example, one individual can have multiple observations if they changed schools, for each school year, or if their economic status changed in the middle of a school year.</p>
<p>My goal is to end up with a dataset where each observation (row) represents a unique (unduplicated) individual that’s tied to the school from which they graduated. Here’s how I will do that.</p>
<ul>
<li>PersonID: change to integer</li>
<li>K12OrganizationID: change to integer.</li>
<li>K12EnrTimeID: Change so it’s only the year</li>
<li>Grade: eliminate - unimportant since we are mostly concerned about whether they graduated.</li>
<li>EconomicStatusIndicator: I will change this to two categories. Whether they were ever eligible for reduce priced or free meal will be coded as 1 (eligible = codes 1, 2, 4, 5) at any point in the dataset. The remaining will be coded as 0.</li>
<li>FederalRaceIndicator: eliminate - I’m going to use the RaceEthnicity column instead.</li>
<li>PSEO columns: I’m most concerned about whether they participated in PSEO or not. A new column will be created indicated whether there was a “Y” coded for either the “PSEOConcurrentEnrollmentIndicator” or “PostSecondaryEnrollmentOptionsIndicator” columns at any point in the dataset. The two original columns will be eliminated.</li>
<li>StatusEnd: I will only include individuals that have StatusEnd coded as an 8 or 9.</li>
<li>Gender: included and not changed.</li>
<li>SpecialEdStatus: I will split this into two categories. The first is that a student did not require special education services (codes 1-2) at any point in the dataset. The other category will be that they require special education (codes 4 - 9) at any point in the dataset.</li>
<li>Limited English: keep with no changes.</li>
<li>Primary language: I’m going to create two categories. One being that English is the primary language while the other will be that English is NOT the primary language at any point in the dataset.</li>
<li>Homeless: Keep with no changes.</li>
</ul>
<p>We first need to create a list of all individuals with the StatusEnd code of 8 or 9 (graduated). This will be the list on which we will bind all the other variables.</p>
<p><br></p>
<pre class="r"><code>graduates &lt;- enrollment %&gt;%
  filter(StatusEnd %in% c(8,9)) %&gt;%
  select(PersonID, K12OrganizationID, Gender, LimitedEnglishProficiencyIndicator, HomelessIndicator)

duplicates &lt;- graduates %&gt;%
  group_by(PersonID) %&gt;%
  summarise(n = n()) %&gt;%
  ungroup() %&gt;%
  filter(n &gt; 1)</code></pre>
<p><br></p>
<p>Unfortunately, we still end up with duplicates. We will send this to Meredith to figure out.</p>
<p>Next we need to create new columns for the variables that will indicate a certain status has been met at any point in the dataset for each PersonID. For example, we want a column that indicates a PersonID was enrolled in PSEO at some point in the dataset. The variables that need a new column created are;</p>
<ul>
<li>EconomicStatusIndicator</li>
<li>PostSecondaryEnrollmentOptionsIndicator &amp; PSEOConcurrentEnrollmentIndicator</li>
<li>SpecialEdStatus</li>
<li>HomeprimaryLanguage</li>
</ul>
<p><br></p>
<pre class="r"><code># Lets start with economic status indicator
k12.enr.esi.indicator &lt;- enrollment %&gt;%
  select(PersonID, EconomicStatusIndicator) %&gt;%
  group_by(PersonID) %&gt;%
  mutate(economic.status.code = ifelse(EconomicStatusIndicator %in% c(1,2,4,5), 1, 0),
         economic.status.code.sum = sum(economic.status.code)) %&gt;%
  ungroup() %&gt;%
  distinct(PersonID, .keep_all = TRUE) %&gt;%
  mutate(economic.status = ifelse(economic.status.code.sum &gt; 0, 1, 0)) %&gt;%
  select(PersonID, economic.status)

# PSEO

k12.enr.pseo.indicator &lt;- enrollment %&gt;%
  select(PersonID, PostSecondaryEnrollmentOptionsIndicator, PSEOConcurrentEnrollmentIndicator) %&gt;%
  mutate(PostSecondaryEnrollmentOptionsIndicator = ifelse(PostSecondaryEnrollmentOptionsIndicator == &quot;Y&quot;, 1, 0),
         PSEOConcurrentEnrollmentIndicator = ifelse(PSEOConcurrentEnrollmentIndicator == &quot;Y&quot;, 1, 0)) %&gt;%
  gather(key = &quot;pseo.type&quot;, value = &quot;indicator&quot;, 2:3) %&gt;%
  group_by(PersonID) %&gt;%
  summarise(pseo = sum(indicator)) %&gt;%
  mutate(pseo.participant = ifelse(pseo &gt; 0, 1, 0)) %&gt;%
  ungroup() %&gt;%
  select(PersonID, pseo.participant)

# Special Ed status

k12.enr.spced.indicator &lt;- enrollment %&gt;%
  select(PersonID, SpecialEdStatus) %&gt;%
  mutate(SpecialEdStatus.code = ifelse(SpecialEdStatus %in% c(4,5,6,7,8,9), 1, 0)) %&gt;%
  group_by(PersonID) %&gt;%
  summarise(SpecialEdStatus.sum = sum(SpecialEdStatus.code)) %&gt;%
  ungroup() %&gt;%
  mutate(SpecialEdStatus = ifelse(SpecialEdStatus.sum &gt; 0, 1, 0)) %&gt;%
  select(PersonID, SpecialEdStatus)

# Home Primary Language

k12.enr.homeprimlang.indicator &lt;- enrollment %&gt;%
  select(PersonID, HomePrimaryLanguage) %&gt;%
  mutate(HomePrimaryLanguage.code = ifelse(HomePrimaryLanguage == 11, 0, 1)) %&gt;%
  group_by(PersonID) %&gt;%
  summarise(HomePrimaryLanguage.sum = sum(HomePrimaryLanguage.code)) %&gt;%
  ungroup() %&gt;%
  mutate(non.english.home = ifelse(HomePrimaryLanguage.sum &gt; 0, 1, 0)) %&gt;%
  select(PersonID, non.english.home)</code></pre>
<p><br></p>
<p>Now we can combine the list of graduates with the status indicators.</p>
<p><br></p>
<pre class="r"><code>k12.enrollment.master &lt;- graduates %&gt;%
  left_join(k12.enr.esi.indicator, by = &quot;PersonID&quot;) %&gt;%
  left_join(k12.enr.pseo.indicator, by = &quot;PersonID&quot;) %&gt;%
  left_join(k12.enr.spced.indicator, by = &quot;PersonID&quot;) %&gt;%
  left_join(k12.enr.homeprimlang.indicator, by = &quot;PersonID&quot;)

head(k12.enrollment.master)</code></pre>
<pre><code>## # A tibble: 6 × 9
##   PersonID K12OrganizationID Gender LimitedEnglishProficiencyI… HomelessIndicat…
##      &lt;int&gt;             &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;                       &lt;chr&gt;           
## 1       68            124084 F      N                           N               
## 2      161             77452 M      N                           N               
## 3      641             38385 M      N                           N               
## 4      676             55598 M      N                           N               
## 5      758             22675 M      N                           N               
## 6      786             56633 F      N                           N               
## # … with 4 more variables: economic.status &lt;dbl&gt;, pseo.participant &lt;dbl&gt;,
## #   SpecialEdStatus &lt;dbl&gt;, non.english.home &lt;dbl&gt;</code></pre>
<pre class="r"><code>names(k12.enrollment.master)</code></pre>
<pre><code>## [1] &quot;PersonID&quot;                           &quot;K12OrganizationID&quot;                 
## [3] &quot;Gender&quot;                             &quot;LimitedEnglishProficiencyIndicator&quot;
## [5] &quot;HomelessIndicator&quot;                  &quot;economic.status&quot;                   
## [7] &quot;pseo.participant&quot;                   &quot;SpecialEdStatus&quot;                   
## [9] &quot;non.english.home&quot;</code></pre>
<p><br></p>
<p>The prepped enrollment data has 45,689 observations and 9 columns.</p>
</div>
<div id="section-k12orgs" class="section level1">
<h1>K12Orgs</h1>
<p>Up next is combining the school locations. The MN Department of Education uses their own codes for Minnesota counties and don’t relate to countyfp. So I’m going to import their codes and combine them with the countyfp since that’s what I’m used to using. I’m also going to import the zip codes and the EDR and planning regions for each county allowing me to analyze the data at various regional levels.</p>
<p><br></p>
<pre class="r"><code>k12.county.codes &lt;- read_csv(&quot;Data/SLEDS/K12 Org/K12-county-codes.csv&quot;)

zip &lt;- read_xlsx(&quot;Data/Join docs/zip-city-county.xlsx&quot;)

counties.regions &lt;- read_csv(&quot;Data/Join docs/county_regions.csv&quot;) %&gt;%
  rename(mif = `MIF Region`) %&gt;%
  mutate(countyfp = formatC(countyfp, width = 3, flag = &quot;0&quot;),
         Name = str_to_title(Name),
         Name = str_replace(Name, &quot;Q&quot;, &quot;q&quot;),
         Name = str_replace(Name, &quot;Of The&quot;, &quot;of the&quot;),
         Name = str_replace(Name, &quot;Mcleod&quot;, &quot;McLeod&quot;),
         Dem_Desc = ifelse(Name == &quot;Minnesota&quot;, &quot;Minnesota&quot;, Dem_Desc) ,
         edr = str_replace(edr, &quot;  &quot;, &quot; &quot;),
         planning.region = str_replace(planning.region, &quot; Minnesota&quot;, &quot;&quot;),
         planning.region = fct_relevel(planning.region, &quot;Northwest&quot;, &quot;Northeast&quot;, &quot;Central&quot;, &quot;Seven County Mpls-St Paul&quot;, &quot;Southwest&quot;, &quot;Southeast&quot;),
         edr = fct_relevel(edr, &quot;EDR 1 - Northwest&quot;, &quot;EDR 2 - Headwaters&quot;, &quot;EDR 3 - Arrowhead&quot;, &quot;EDR 4 - West Central&quot;, &quot;EDR 5 - North Central&quot;, &quot;EDR 6E- Southwest Central&quot;, &quot;EDR 6W- Upper Minnesota Valley&quot;, &quot;EDR 7E- East Central&quot;, &quot;EDR 7W- Central&quot;, &quot;EDR 8 - Southwest&quot;, &quot;EDR 9 - South Central&quot;, &quot;EDR 10 - Southeast&quot;, &quot;EDR 11 - 7 County Twin Cities&quot;, &quot;Minnesota&quot;),
         mif = ifelse(is.na(mif), &quot;TC&quot;, mif),
         mif = as.factor(mif),
         mif = fct_relevel(mif, &quot;NW&quot;, &quot;NE&quot;, &quot;WC&quot;, &quot;EC&quot;, &quot;SW&quot;, &quot;SE&quot;, &quot;TC&quot;))</code></pre>
<p><br></p>
<p>Now I’ll bring in the K12organization data.</p>
<p><br></p>
<pre class="r"><code>k12.org &lt;- read_xlsx(&quot;Data/SLEDS/K12 Org/K12Orgs 20220629.xlsx&quot;) %&gt;%
  distinct(K12OrganizationID, .keep_all = TRUE) %&gt;%
  drop_na(K12OrganizationID) %&gt;%
  mutate(K12OrganizationID = as.integer(K12OrganizationID))

head(k12.org)</code></pre>
<pre><code>## # A tibble: 6 × 16
##   K12OrganizationID DistrictID SchoolNumber StateOrganizationID StateFiscalYear
##               &lt;int&gt;      &lt;dbl&gt;        &lt;dbl&gt;               &lt;dbl&gt;           &lt;dbl&gt;
## 1                54        121            2         10252002000            2008
## 2                55        121            2         10252002000            2006
## 3                56        121            2         10252002000            2007
## 4                62        121            2         10252002000            2014
## 5                63        121            2         10252002000            2009
## 6                64        121            2         10252002000            2010
## # … with 11 more variables: NCESID &lt;dbl&gt;, Institution &lt;chr&gt;,
## #   Classification &lt;dbl&gt;, PhysicalCity &lt;chr&gt;, County &lt;dbl&gt;, EcoDevRegion &lt;chr&gt;,
## #   DistrictNumber &lt;dbl&gt;, DistrictType &lt;dbl&gt;, DistrictName &lt;chr&gt;,
## #   DistrictCountyCode &lt;dbl&gt;, PhysicalCity_District &lt;chr&gt;</code></pre>
<pre class="r"><code>names(k12.org)</code></pre>
<pre><code>##  [1] &quot;K12OrganizationID&quot;     &quot;DistrictID&quot;            &quot;SchoolNumber&quot;         
##  [4] &quot;StateOrganizationID&quot;   &quot;StateFiscalYear&quot;       &quot;NCESID&quot;               
##  [7] &quot;Institution&quot;           &quot;Classification&quot;        &quot;PhysicalCity&quot;         
## [10] &quot;County&quot;                &quot;EcoDevRegion&quot;          &quot;DistrictNumber&quot;       
## [13] &quot;DistrictType&quot;          &quot;DistrictName&quot;          &quot;DistrictCountyCode&quot;   
## [16] &quot;PhysicalCity_District&quot;</code></pre>
<p><br></p>
<p>This dataset provides each school institution as of June 29, 2022. This isn’t a list of each school but rather a list of each K12OrganizationID. Each school will have multiple K12OrganizationID. I’m not sure why and this would be something to ask Meredith.</p>
<p>My goal is to join my standardized region and county code data with this document which will then be joined to the master enrollment document. Unfortunatley the main data does not include county name but rather their own code for county. So I will join their codes with the county names and then use my counties.regions data to bring together the remaining regions.</p>
<p><br></p>
<pre class="r"><code>k12.org.master &lt;- k12.org %&gt;%
  select(K12OrganizationID, County, DistrictName) %&gt;%
  left_join(k12.county.codes[,c(1,2)], by = c(&quot;County&quot; = &quot;county.code&quot;)) %&gt;%
  rename(county.name = 4) %&gt;%
  mutate(county.name = str_replace(county.name, &quot; County&quot;, &quot;&quot;)) %&gt;%
  select(K12OrganizationID, DistrictName, county.name) %&gt;%
  mutate(county.name = str_replace(county.name, &quot;Saint Louis&quot;, &quot;St. Louis&quot;)) %&gt;%
  left_join(counties.regions, by = c(&quot;county.name&quot; = &quot;Name&quot;)) %&gt;%
  select(-Dem_RUCA, -planning.region, -mif)

head(k12.org.master)</code></pre>
<pre><code>## # A tibble: 6 × 6
##   K12OrganizationID DistrictName             county.name countyfp Dem_Desc edr  
##               &lt;int&gt; &lt;chr&gt;                    &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt;    &lt;fct&gt;
## 1                54 CANNON FALLS PUBLIC SCH… Goodhue     049      Urban/t… EDR …
## 2                55 CANNON FALLS PUBLIC SCH… Goodhue     049      Urban/t… EDR …
## 3                56 CANNON FALLS PUBLIC SCH… Goodhue     049      Urban/t… EDR …
## 4                62 CANNON FALLS PUBLIC SCH… Goodhue     049      Urban/t… EDR …
## 5                63 CANNON FALLS PUBLIC SCH… Goodhue     049      Urban/t… EDR …
## 6                64 CANNON FALLS PUBLIC SCH… Goodhue     049      Urban/t… EDR …</code></pre>
<pre class="r"><code>names(k12.org.master)</code></pre>
<pre><code>## [1] &quot;K12OrganizationID&quot; &quot;DistrictName&quot;      &quot;county.name&quot;      
## [4] &quot;countyfp&quot;          &quot;Dem_Desc&quot;          &quot;edr&quot;</code></pre>
<p><br></p>
<p>The k12org master data has 15,404 K12OrganizationIDs and 6 columns. Now I will join it with our master enrollment data using the k12OrganizationID.</p>
<p><br></p>
<pre class="r"><code>master &lt;- k12.enrollment.master %&gt;%
  left_join(k12.org.master, by = &quot;K12OrganizationID&quot;)

head(master)</code></pre>
<pre><code>## # A tibble: 6 × 14
##   PersonID K12OrganizationID Gender LimitedEnglishProficiencyI… HomelessIndicat…
##      &lt;int&gt;             &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;                       &lt;chr&gt;           
## 1       68            124084 F      N                           N               
## 2      161             77452 M      N                           N               
## 3      641             38385 M      N                           N               
## 4      676             55598 M      N                           N               
## 5      758             22675 M      N                           N               
## 6      786             56633 F      N                           N               
## # … with 9 more variables: economic.status &lt;dbl&gt;, pseo.participant &lt;dbl&gt;,
## #   SpecialEdStatus &lt;dbl&gt;, non.english.home &lt;dbl&gt;, DistrictName &lt;chr&gt;,
## #   county.name &lt;chr&gt;, countyfp &lt;chr&gt;, Dem_Desc &lt;chr&gt;, edr &lt;fct&gt;</code></pre>
<pre class="r"><code>names(master)</code></pre>
<pre><code>##  [1] &quot;PersonID&quot;                           &quot;K12OrganizationID&quot;                 
##  [3] &quot;Gender&quot;                             &quot;LimitedEnglishProficiencyIndicator&quot;
##  [5] &quot;HomelessIndicator&quot;                  &quot;economic.status&quot;                   
##  [7] &quot;pseo.participant&quot;                   &quot;SpecialEdStatus&quot;                   
##  [9] &quot;non.english.home&quot;                   &quot;DistrictName&quot;                      
## [11] &quot;county.name&quot;                        &quot;countyfp&quot;                          
## [13] &quot;Dem_Desc&quot;                           &quot;edr&quot;</code></pre>
<p><br></p>
<p>The updated master sheet has 45,689 observations. Unfortunately, there are 23 observations that have NA in the location of the school. The K12OrganizationID does not have an associated school name or location. There are 14 columns in the master dataset so far.</p>
</div>
<div id="section-act" class="section level1">
<h1>ACT</h1>
<p>Next up is to join the ACT data.</p>
<p><br></p>
<pre class="r"><code>act &lt;- read_csv(&quot;Data/SLEDS/ACT/ACT.csv&quot;) %&gt;%
  mutate(PersonID = as.integer(PersonID))

head(act)</code></pre>
<pre><code>## # A tibble: 6 × 7
##   PersonID ACTTimeID EnglishScaleScore MathScaleScore ReadingScaleScore
##      &lt;int&gt;     &lt;dbl&gt;             &lt;dbl&gt;          &lt;dbl&gt;             &lt;dbl&gt;
## 1       68  20051201                21             20                16
## 2      161  20080401                25             27                23
## 3      161  20081001                28             26                31
## 4      786  20091001                21             18                22
## 5     1162  20180401                23             19                20
## 6     1698  20060201                16             18                21
## # … with 2 more variables: ScienceScaleScore &lt;dbl&gt;, ACTCompositeScore &lt;dbl&gt;</code></pre>
<pre class="r"><code>names(act)</code></pre>
<pre><code>## [1] &quot;PersonID&quot;          &quot;ACTTimeID&quot;         &quot;EnglishScaleScore&quot;
## [4] &quot;MathScaleScore&quot;    &quot;ReadingScaleScore&quot; &quot;ScienceScaleScore&quot;
## [7] &quot;ACTCompositeScore&quot;</code></pre>
<p><br></p>
<p>There are 33,047 observations in the dataset. Each observation is an ACT test taken by a student in Southwest Minnesota. The unique feature here is the time it was taken. This means that a student could have taken the ACT twice and their PersonID would show up as two observations.</p>
<p>Out of the scores provided, I’m just going to use the composite score. Since an individual may have taken the test multiple times I will only use the highest composite score for each individual. This is how colleges do it as well.</p>
<p><br></p>
<pre class="r"><code>act.highest.comp &lt;- act %&gt;%
  select(PersonID, ACTCompositeScore) %&gt;%
  mutate(PersonID = as.integer(PersonID)) %&gt;%
  group_by(PersonID) %&gt;%
  filter(ACTCompositeScore == max(ACTCompositeScore)) %&gt;%
  ungroup() %&gt;%
  distinct(PersonID, .keep_all = TRUE)

head(act.highest.comp)</code></pre>
<pre><code>## # A tibble: 6 × 2
##   PersonID ACTCompositeScore
##      &lt;int&gt;             &lt;dbl&gt;
## 1       68                20
## 2      161                29
## 3      786                21
## 4     1162                21
## 5     1698                19
## 6     1951                28</code></pre>
<pre class="r"><code>names(act.highest.comp)</code></pre>
<pre><code>## [1] &quot;PersonID&quot;          &quot;ACTCompositeScore&quot;</code></pre>
<p><br></p>
<p>After filtering for only the highest ACT composite score for each PersonID, the dataset contains 28,902 observations.</p>
<p>Now we will join it up with the master.</p>
<p><br></p>
<pre class="r"><code>master.2 &lt;- master %&gt;%
  left_join(act.highest.comp, by = &quot;PersonID&quot;)

head(master.2)</code></pre>
<pre><code>## # A tibble: 6 × 15
##   PersonID K12OrganizationID Gender LimitedEnglishProficiencyI… HomelessIndicat…
##      &lt;int&gt;             &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;                       &lt;chr&gt;           
## 1       68            124084 F      N                           N               
## 2      161             77452 M      N                           N               
## 3      641             38385 M      N                           N               
## 4      676             55598 M      N                           N               
## 5      758             22675 M      N                           N               
## 6      786             56633 F      N                           N               
## # … with 10 more variables: economic.status &lt;dbl&gt;, pseo.participant &lt;dbl&gt;,
## #   SpecialEdStatus &lt;dbl&gt;, non.english.home &lt;dbl&gt;, DistrictName &lt;chr&gt;,
## #   county.name &lt;chr&gt;, countyfp &lt;chr&gt;, Dem_Desc &lt;chr&gt;, edr &lt;fct&gt;,
## #   ACTCompositeScore &lt;dbl&gt;</code></pre>
<pre class="r"><code>names(master.2)</code></pre>
<pre><code>##  [1] &quot;PersonID&quot;                           &quot;K12OrganizationID&quot;                 
##  [3] &quot;Gender&quot;                             &quot;LimitedEnglishProficiencyIndicator&quot;
##  [5] &quot;HomelessIndicator&quot;                  &quot;economic.status&quot;                   
##  [7] &quot;pseo.participant&quot;                   &quot;SpecialEdStatus&quot;                   
##  [9] &quot;non.english.home&quot;                   &quot;DistrictName&quot;                      
## [11] &quot;county.name&quot;                        &quot;countyfp&quot;                          
## [13] &quot;Dem_Desc&quot;                           &quot;edr&quot;                               
## [15] &quot;ACTCompositeScore&quot;</code></pre>
<p><br></p>
<p>The updated master dataset contains 45,689 observations with 15 columns.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("section-TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#section-TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
